rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }

    function isAdmin() {
      return isAuthenticated() && request.auth.token.admin == true;
    }

    // Public Pages & Blogs
    match /pages/{pageId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /blogs/{blogId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Locations
    match /locations/{locationId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Authors (Blog)
    match /authors/{authorId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Calculations (History/Analytics)
    match /calculations/{calcId} {
      allow read: if isAdmin();
      allow create: if true; // Public can save calculations
      allow update, delete: if isAdmin();
    }

    // SEO Settings
    match /seoSettings/{settingId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Analytics (Internal)
    match /analytics/{docId} {
      allow read, write: if isAdmin();
    }

    // Users
    match /users/{userId} {
      allow read, write: if isAdmin() || (isAuthenticated() && request.auth.uid == userId);
    }

    // Menus (Dynamic Navigation)
    match /menus/{menuId} {
      allow read: if true;  // Public read for client app
      allow write: if isAdmin();  // Only admins can create/update/delete menus
    }

    // Widgets (Homepage & Dynamic Content)
    match /widgets/{widgetId} {
      allow read: if true;  // Public read for displaying widgets
      allow write: if isAdmin();  // Only admins can manage widgets
    }

    // Site Settings (Global Configuration)
    match /siteSettings/{settingId} {
      allow read: if true;  // Public read for site configuration
      allow write: if isAdmin();  // Only admins can update settings
    }

    // Keywords (SEO Management)
    match /keywords/{keywordId} {
      allow read: if true;  // Public read for SEO
      allow write: if isAdmin();  // Only admins can manage keywords
    }

    // Redirects (URL Management)
    match /redirects/{redirectId} {
      allow read: if true;  // Public read for redirect handling
      allow write: if isAdmin();  // Only admins can create redirects
    }
  }
}
